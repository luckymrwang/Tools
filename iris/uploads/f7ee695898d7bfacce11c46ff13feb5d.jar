apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: application-yd4
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: application
    spec:
      initContainers:
      - command:
        - sh
        - "-c"
        - |
           set -ex
           cp /root/helloworld.war /usr
        image: yd-base-image:0.1
        name: application-init
        resources:
          limits:
            cpu: 300m
            memory: 300Mi
          requests:
            cpu: 300m
            memory: 300Mi
        volumeMounts:
        - mountPath: /usr
          name: app-volume
      containers:
      - image: 10.180.249.20:30013/library/tomcat:8.5.39
        name: application
        resources:
          limits:
            cpu: 300m
            memory: 300Mi
          requests:
            cpu: 300m
            memory: 300Mi
        volumeMounts:
        - mountPath: /usr/local/tomcat/webapps/helloworld.war
          name: app-volume
          subPath: helloworld.war
      nodeSelector:
          kubernetes.io/hostname: k8s2
      volumes:
      - name: app-volume
        emptyDir: {}
